name: T1059 - Malicious Command Execution via Python
type: any
index: logs-endpoint.events.process-default-2025.03.27-000001
description: Detects malicious use of Python to execute commands.

alert:
  - email

email:
  - hachangmeo@gmail.com
  
smtp_host: smtp.gmail.com
smtp_port: 587
smtp_ssl: false
from_addr: hanchiangzo@gmail.com
smtp_auth_file: ../smtp_auth.yaml

filter:
  - query:
      query_string:
        query: >
          process.command_line.text: *sh -c* AND *import requests* AND *python -c* AND *import os*

include:
  - process.command_line.text
  - process.parent_name
  - user.name

alert_subject: "[T1059] Python Command Execution Detected"
alert_subject_args:
  - process.command_line.text

alert_text: |
  Possible malicious Python usage detected.

  Command: {0}

alert_text_args:
  - process.command_line.text

realert:
  minutes: 60

priority: 2
